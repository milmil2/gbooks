<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<link rel="stylesheet" href="css/sample.css">
<title>GoogleBook検索</title>
</head>
<body>

  <header>
   
  </header>

  <main>

    <div class="search">
      <p>本を検索できます</p>
      題名: <input type="text" id="keyword_title" value="">
      著者: <input type="text" id="keyword_author" value="">
      <button id="readbook">検索</button>
      
    </div>

    <p><span class="total"></span></p>
    <button id="filter">出版日順で並べ替える</button>
    <p id="content">


    </p>
  </main>


<script src="js/jquery-3.5.1.min.js"></script>
<script>
// 手順

$("#readbook").on("click", function(){

  const keyword_title = $("#keyword_title").val();
  const keyword_author = $("#keyword_author").val();

  if (keyword_title == ""){
    const qurl = "https://www.googleapis.com/books/v1/volumes?q=inauthor:" + keyword_author;
    console.log(qurl);
    $.get(qurl, function(data){
  const items = data.items;
  const totalItems = data.totalItems;
  const publishedDate = data.publishedDate;
  console.log(totalItems);
  let view = "";

  if(totalItems == 0){
    $(".total").html("該当がありません");
    $("#content").html("");
  }else {
    for( let i = 0; i<items.length; i++) {
    const item = items[i];
    console.log(item);
    const title = item.volumeInfo.title;
    const author = item.volumeInfo.authors;
    const publishedDate = item.volumeInfo.publishedDate;
    view += "<ul><li>題名:" + title + "<br>" + "著者：" + author + "<br>" + publishedDate + "</li></ul>";
  }
  $("#content").html(view);
  $(".total").html(totalItems + "件中" + items.length + "件表示");
  };
  
});
  }else{
  const qurl = "https://www.googleapis.com/books/v1/volumes?q=intitle:" + keyword_title + "+inauthor:" + keyword_author;
  $.get(qurl, function(data){
  const items = data.items;
  const totalItems = data.totalItems;
  console.log(totalItems);
  let view = "";

  if(totalItems == 0){
    $(".total").html("該当がありません");
    $("#content").html("");
  }else {
    for( let i = 0; i<items.length; i++) {
    const item = items[i];
    console.log(item);
    const title = item.volumeInfo.title;
    const author = item.volumeInfo.authors;
    const publishedDate = item.volumeInfo.publishedDate;
    view += "<ul><li>題名:" + title + "<br>" + "著者：" + author +"<br>" + publishedDate + "</li></ul>";
  }

   
  $("#content").html(view);
  $(".total").html(totalItems + "件中" + items.length + "件表示");
  };
  
});
};
});


// "&orderBy=newest";
$("#filter").on("click", function(){

  const keyword_title = $("#keyword_title").val();
  const keyword_author = $("#keyword_author").val();

  if (keyword_title == ""){
    const qurl = "https://www.googleapis.com/books/v1/volumes?q=inauthor:" + keyword_author + "&orderBy=newest";
    console.log(qurl);
    $.get(qurl, function(data){
  const items = data.items;
  const totalItems = data.totalItems;
  const publishedDate = data.publishedDate;
  console.log(totalItems);
  let view = "";

  if(totalItems == 0){
    $(".total").html("該当がありません");
    $("#content").html("");
  }else {
    for( let i = 0; i<items.length; i++) {
    const item = items[i];
    console.log(item);
    const title = item.volumeInfo.title;
    const author = item.volumeInfo.authors;
    const publishedDate = item.volumeInfo.publishedDate;
    view += "<ul><li>題名:" + title + "<br>" + "著者：" + author + "<br>" + publishedDate + "</li></ul>";
  }
  $("#content").html(view);
  $(".total").html(totalItems + "件中" + items.length + "件表示");
  };
  
});
  }else{
  const qurl = "https://www.googleapis.com/books/v1/volumes?q=intitle:" + keyword_title + "+inauthor:" + keyword_author + "&orderBy=newest";
  $.get(qurl, function(data){
  const items = data.items;
  const totalItems = data.totalItems;
  console.log(totalItems);
  let view = "";

  if(totalItems == 0){
    $(".total").html("該当がありません");
    $("#content").html("");
  }else {
    for( let i = 0; i<items.length; i++) {
    const item = items[i];
    console.log(item);
    const title = item.volumeInfo.title;
    const author = item.volumeInfo.authors;
    const publishedDate = item.volumeInfo.publishedDate;
    view += "<ul><li>題名:" + title + "<br>" + "著者：" + author +"<br>" + publishedDate + "</li></ul>";
  }

   
  $("#content").html(view);
  $(".total").html(totalItems + "件中" + items.length + "件表示");
  };
  
});
};
});






// ---ここからは課題！
// 1. $.get() を使って 情報を取得する
 // 2. JSONデータ構造を基に本のタイトルを取得する
 // 3. 本のタイトル情報をHTMLに出力する
// 4. クリックイベントで括る
// 5. id="keyword"の入力値を取得 → URLの"?q=jquery"の"queryの文字を取得した入力値（変数）に変える"
// 6. 出版社も表示してみよう！（データ構造はconsole.logで確認！！）

// $.get() を使う[開始]

// $.get() を使う[終了]

// 保存機能

</script>
</body>
</html>
